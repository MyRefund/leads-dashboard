<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Language" content="en">
<meta name="google" content="notranslate">

<title>My Refund â€” Leads Management</title>

<style>
:root{
  --g0:#094B35;
  --g1:#03953F;
  --g2:#ECFDF5;
  --text:#111827;
  --radius:16px;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Okta Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#f9fafb;
  color:var(--text);
}

/* HEADER */
.header{background:var(--g0);color:#fff;padding:18px 28px}
.header-inner{max-width:1300px;margin:0 auto;display:flex;align-items:center}
.brand img{height:28px}

/* NAV */
.nav-tabs{background:#fff;border-bottom:1px solid #e5e7eb}
.nav-inner{max-width:1300px;margin:0 auto;padding:0 24px;display:flex;gap:30px}
.nav-tab{
  padding:16px 0;font-weight:900;font-size:14px;cursor:pointer;
  color:#6b7280;border-bottom:3px solid transparent
}
.nav-tab.active{color:var(--g0);border-bottom:3px solid var(--g1)}

.page-wrapper{max-width:1300px;margin:50px auto;padding:0 24px 80px}
.section-title{font-size:20px;font-weight:900;color:var(--g0);margin-bottom:18px}

.form-grid{display:grid;gap:14px;max-width:620px;margin-bottom:26px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.row > *{flex:1}

input,select{
  padding:12px 14px;border-radius:14px;border:1px solid #e5e7eb;
  font-size:14px;width:100%
}

.primary-btn{
  background:var(--g0);color:#fff;border:none;border-radius:14px;
  padding:12px 18px;font-weight:900;cursor:pointer
}
.primary-btn:hover{background:#0b5c42}

.banner{
  display:none;padding:14px 16px;border-radius:14px;font-weight:900;margin:10px 0 22px
}
.banner.success{background:#ECFDF5;border:1px solid #BBF7D0;color:var(--g0)}
.banner.error{background:#FEF2F2;border:1px solid #FECACA;color:#7F1D1D}

.page{display:none}
.page.active{display:block}
</style>
</head>

<body>

<div class="header">
  <div class="header-inner">
    <div class="brand">
      <img src="logo.png" alt="My Refund">
    </div>
  </div>
</div>

<div class="nav-tabs">
  <div class="nav-inner">
    <div class="nav-tab active" data-page="lists">Lists</div>
  </div>
</div>

<div class="page-wrapper">

  <div class="page active" id="page-lists">
    <div class="section-title">Upload List (CSV)</div>
    <div class="banner" id="banner-lists"></div>

    <div class="form-grid">
      <input type="text" id="list-name" placeholder="List Name (e.g. Drop Offs 27/02)" />

      <div class="row">
        <select id="list-type">
          <option value="Lead Upload">Lead Upload</option>
          <option value="Signed Up Import">Signed Up Import</option>
          <option value="Removal Import">Removal Import</option>
        </select>

        <select id="channel">
          <option value="Email">Email</option>
          <option value="SMS">SMS</option>
        </select>
      </div>

      <input type="file" id="csv-file" accept=".csv" />
      <button class="primary-btn" onclick="uploadCsv()">Upload</button>
    </div>
  </div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbya6ZUeAB7-HC8ImkkeSy4llDelebL6dhPHEPTQiweiggqz-hIn3oZ-Lus3ANnZcTO42Q/exec";

function showBanner(type,msg){
  const el=document.getElementById("banner-lists");
  el.className="banner "+type;
  el.textContent=msg;
  el.style.display="block";
}

function parseCsvFirstColumn(text){
  const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  const cleaned=lines.map(l=>l.split(",")[0].trim().replace(/^"|"$/g,""));
  return Array.from(new Set(cleaned.filter(Boolean)));
}

async function uploadCsv(){
  const listName=document.getElementById("list-name").value.trim();
  const listType=document.getElementById("list-type").value;
  const channel=document.getElementById("channel").value;
  const file=document.getElementById("csv-file").files[0];

  if(!listName){
    showBanner("error","Please enter a list name.");
    return;
  }
  if(!file){
    showBanner("error","Please select a CSV file.");
    return;
  }

  const text=await file.text();
  const records=parseCsvFirstColumn(text);

  let action="uploadList";
  if(listType==="Signed Up Import") action="uploadSignedUp";
  if(listType==="Removal Import") action="uploadRemoval";

  try{
    await fetch(API_URL,{
      method:"POST",
      mode:"no-cors",   /* FIXED CORS */
      body:JSON.stringify({
        action,
        listName,
        channel,
        records
      })
    });

    showBanner("success","Upload processed successfully.");
    document.getElementById("csv-file").value="";
  }
  catch(err){
    showBanner("error","Upload failed.");
  }
}
</script>

</body>
</html>
